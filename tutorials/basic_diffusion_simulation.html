<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial 1: Basic Diffusion Simulation &mdash; OpenSn  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 2: Other Forms of Output" href="output.html" />
    <link rel="prev" title="Basic Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OpenSn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install_linux.html">Compiling on Personal Linux Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_linux_easy.html">Easy install on Ubuntu Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_macos.html">Compiling on MacOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_macos_easy.html">Easy Install on MacOS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Basic Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial 1: Basic Diffusion Simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-create-your-input-file-open-it-in-a-text-editor">Step 1 - Create your input file, open it in a text editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-create-a-mesh-handler">Step 2 - Create a mesh handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-create-a-3d-mesh">Step 3 - Create a 3D mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-executing-the-mesher">Step 4 -  Executing the mesher</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-assign-material-and-boundary-ids-and">Step 5 - Assign material- and boundary IDs and</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#boundary-ids">Boundary IDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Boundary IDs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-adding-material-properties">Step 5 - Adding material properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-set-up-the-diffusion-physics">Step 6 - Set up the diffusion physics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-7-initialize-and-solve">Step 7 - Initialize and Solve</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-8-post-processing">Step 8 - Post-processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-input-file">Complete input file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-9-execute-the-code">Step 9 - Execute the code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Tutorial 2: Other Forms of Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_transport_simulation.html">Tutorial 3: Basic Transport Simulation</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenSn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Basic Tutorials</a></li>
      <li class="breadcrumb-item active">Tutorial 1: Basic Diffusion Simulation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-1-basic-diffusion-simulation">
<h1>Tutorial 1: Basic Diffusion Simulation<a class="headerlink" href="#tutorial-1-basic-diffusion-simulation" title="Link to this heading"></a></h1>
<p>Let us tackle the basic diffusion equation as applied to steady state heat
transfer on a 3D orthogonal mesh.</p>
<div class="math notranslate nohighlight">
\[
-\nabla \cdot k \nabla T = q
\]</div>
<p>The purpose of this tutorial is to understand the basics of the
input paradigm which is completely different from the traditional
input-card based method.
OpenSn uses an embedded Lua console. For a history of Lua please see its
wikipedia page
<a href="https://en.wikipedia.org/wiki/Lua_(programming_language)">here</a>.
This paradigm allows the user to control many aspects of the program flow
as well to be more versatile when creating inputs, i.e. reading files, for
loops to create multiple entities etc. So let us get started.</p>
<section id="step-1-create-your-input-file-open-it-in-a-text-editor">
<h2>Step 1 - Create your input file, open it in a text editor<a class="headerlink" href="#step-1-create-your-input-file-open-it-in-a-text-editor" title="Link to this heading"></a></h2>
<p>Go to the directory of your choosing and make an input file of your choosing.
The input file does not require a specific .lua or .inp extension although if you use .lua then
there are many text editors that will be able to provide syntax highlighting.</p>
</section>
<section id="step-2-create-a-mesh-handler">
<h2>Step 2 - Create a mesh handler<a class="headerlink" href="#step-2-create-a-mesh-handler" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chiMeshHandlerCreate</span><span class="p">()</span>
</pre></div>
</div>
<p>This function call creates a new mesh handler and pushes it to a global
stack. It also makes the newly created handler the “current” meaning all
mesh operations will operate on this handler.
The concept of creating, reading or manipulating computational meshes is
centered on operating on a specific <code class="docutils literal notranslate"><span class="pre">chi_mesh::MeshHandler</span></code> object. Physics/math
objects can then freely operate on meshes by simply specifying which handler
to use.</p>
</section>
<section id="step-3-create-a-3d-mesh">
<h2>Step 3 - Create a 3D mesh<a class="headerlink" href="#step-3-create-a-3d-mesh" title="Link to this heading"></a></h2>
<p>For this we will create a simple orthogonal grid of 32x32x32 cells
(32,768 total) as shown in Figure 1.</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="../_images/cube_mesh_tut1.png"><img alt="../_images/cube_mesh_tut1.png" src="../_images/cube_mesh_tut1.png" style="width: 350px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 1 - Mesh spanning from [-1,-1,-1] to [1,1,1]</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The first step of this process is to define an array of nodes starting from -1.0
with a distance \f<span class="math notranslate nohighlight">\( ds \f\)</span> between each of them. In lua we can create this array
programatically:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span><span class="o">=</span><span class="p">{}</span>
<span class="n">N</span><span class="o">=</span><span class="mi">32</span>
<span class="n">ds</span><span class="o">=</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span> <span class="n">do</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ds</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Note here that lua arrays cannot use <code class="docutils literal notranslate"><span class="pre">nodes[0]</span></code> since arrays in lua are not
zero based. The next step is call <code class="docutils literal notranslate"><span class="pre">chiMeshCreateUnpartitioned3DOrthoMesh</span></code> with
the node arrangement along the X-direction, Y-direction and Z-direction,
which in our case is the same,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">surf_mesh</span><span class="p">,</span> <span class="n">region1</span> <span class="o">=</span> <span class="n">chiMeshCreateUnpartitioned3DOrthoMesh</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">nodes</span><span class="p">,</span><span class="n">nodes</span><span class="p">)</span>
</pre></div>
</div>
<p>Some work has been encapsulated behind the scenes here. Firstly, a 2D surface
mesh was created and assigned to a region.
Secondly a surface-mesher (<code class="docutils literal notranslate"><span class="pre">chi_mesh::SurfaceMesher</span></code>)
and a volume mesher (<code class="docutils literal notranslate"><span class="pre">chi_mesh::VolumeMesher</span></code>) has been
assigned to the mesh handler. The volume mesher is not executed because the
macro allows the user to first assign parallel partitioning.</p>
</section>
<section id="step-4-executing-the-mesher">
<h2>Step 4 -  Executing the mesher<a class="headerlink" href="#step-4-executing-the-mesher" title="Link to this heading"></a></h2>
<p>The underlying mesher for a 3D mesh is an extruded mesh from 2D. This mesh
has some partitioning properties that can be set to allow parallel simulations,
however, we will just focus on serial simulations for now.
The next step to complete meshing is to execute the volume mesher. Since we
are not going to set any partitioning parameters we will just execute it now.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chiVolumeMesherExecute</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="step-5-assign-material-and-boundary-ids-and">
<h2>Step 5 - Assign material- and boundary IDs and<a class="headerlink" href="#step-5-assign-material-and-boundary-ids-and" title="Link to this heading"></a></h2>
<p>Materials ID’s can conveniently be specified using logical volumes. There are
many options for logical volumes ranging from primitive parametric surfaces
to non-convex user generated surfaces using surface meshes
(see <code class="docutils literal notranslate"><span class="pre">chiLogicalVolumeCreate</span></code>). For this tutorial
we will use a rectangular paralellipiped (RPP or brick) as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">material</span> <span class="o">=</span> <span class="n">chiPhysicsAddMaterial</span><span class="p">(</span><span class="s2">&quot;Test Material&quot;</span><span class="p">);</span>

<span class="n">vol0</span> <span class="o">=</span> <span class="n">chiLogicalVolumeCreate</span><span class="p">(</span><span class="n">RPP</span><span class="p">,</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">chiVolumeMesherSetProperty</span><span class="p">(</span><span class="n">MATID_FROMLOGICAL</span><span class="p">,</span><span class="n">vol0</span><span class="p">,</span><span class="n">material</span><span class="p">)</span>
</pre></div>
</div>
<p>We first create a material using the <code class="docutils literal notranslate"><span class="pre">chiPhysicsAddMaterial()</span></code> function.
The handle of this material will essentially be zero but it is not technically
required by the <code class="docutils literal notranslate"><span class="pre">chiVolumeMesherSetProperty()</span></code> function since this function
operates on the integer supplied.
This material is added to the physics environment and therefore has scope over
all mesh handlers and all physics entities. We then create a logical volume
using the function <code class="docutils literal notranslate"><span class="pre">chiLogicalVolumeCreate()</span></code> with arguments RPP,
specifying that we will be using a Rectangular Parallelipiped and then a
series of dimensions specifying xmin-xmax-ymin-ymax-zmin-zmax. Every cell
centroid within these dimensions will be flagged as being “within” the logical
volume.</p>
<p>Actually setting the mesh’s material id’s is a utility facilitated by a
volume mesher property and hence we call <code class="docutils literal notranslate"><span class="pre">chiVolumeMesherSetProperty()</span></code>
with a property index MATID_FROMLOGICAL. Next we provided a handle to the
logical volume (vol0) and the desired material id. Logical volumes are very
diverse and their uses are discussed elsewhere. There is an additional utility,
<code class="docutils literal notranslate"><span class="pre">chiVolumeMesherSetMatIDToAll()</span></code>, which will set all cell-material-ids without
requiring a logical volume, however, in this tutorial we opted to show the
logical volume route.</p>
<section id="boundary-ids">
<h3>Boundary IDs<a class="headerlink" href="#boundary-ids" title="Link to this heading"></a></h3>
<p>By default, all boundaries are unassigned (i.e., -1). There are two utilities
that set the boundary id’s the first of which is essentially identical to how
material ids are set, <code class="docutils literal notranslate"><span class="pre">chiVolumeMesherSetProperty()</span></code>, but this time the property
index is <code class="docutils literal notranslate"><span class="pre">BNDRYID_FROMLOGICAL</span></code>. The second way is to use
<code class="docutils literal notranslate"><span class="pre">chiVolumeMesherSetupOrthogonalBoundaries()</span></code> which requires no arguments and will
assign standard indices to a boundary if it is aligned with the orthogonal
cartesian directions.</p>
<p>The culmination of this step is all done within a physics agnostic framework.
The user can even export the mesh for visualization using the function
<code class="docutils literal notranslate"><span class="pre">chiMeshHandlerExportMeshToObj()</span></code>.</p>
</section>
<section id="id1">
<h3>Boundary IDs<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
</section>
</section>
<section id="step-5-adding-material-properties">
<h2>Step 5 - Adding material properties<a class="headerlink" href="#step-5-adding-material-properties" title="Link to this heading"></a></h2>
<p>Now that the cells have been assigned a material id we need to add
properties to the material conducive to a diffusion simulation. For a heat
transfer diffusion simulation we will need to know the thermal conductivity
“k” and the volumetric source strength “q”. Both of these can be simple
scalar values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="n">SCALAR_VALUE</span><span class="p">,</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">SINGLE_VALUE</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="n">SCALAR_VALUE</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="n">SINGLE_VALUE</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>In this code we created the material properties using the function
<code class="docutils literal notranslate"><span class="pre">chiPhysicsMaterialAddProperty()</span></code> which requires a handle to the reference
material, the property type (<code class="docutils literal notranslate"><span class="pre">SCALAR_VALUE</span></code>), and a name for the property.
Unlike extrusion layers the property name can be used in further calls to refer
to the specific property.</p>
<p>Material property values are set using the function
<code class="docutils literal notranslate"><span class="pre">chiPhysicsMaterialSetProperty()</span></code> which again expects a handle to the
reference material, then either a material property id or name (in this case
name), then an operation index and value(s). For this case we used an operation
index <code class="docutils literal notranslate"><span class="pre">SINGLE_VALUE</span></code> which is the only operation supported by <code class="docutils literal notranslate"><span class="pre">SCALAR_VALUE</span></code>. In
future the user can specify, as an example, temperature dependent values which
will support the operation <code class="docutils literal notranslate"><span class="pre">FROM_TABLE</span></code>, but that is a topic for a different time.</p>
</section>
<section id="step-6-set-up-the-diffusion-physics">
<h2>Step 6 - Set up the diffusion physics<a class="headerlink" href="#step-6-set-up-the-diffusion-physics" title="Link to this heading"></a></h2>
<p>The following sequence of function calls completely define the diffusion solver.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phys1</span> <span class="o">=</span> <span class="n">chiDiffusionCreateSolver</span><span class="p">()</span>
<span class="n">chiSolverSetBasicOption</span><span class="p">(</span><span class="n">phys1</span><span class="p">,</span><span class="s2">&quot;discretization_method&quot;</span><span class="p">,</span><span class="s2">&quot;PWLC&quot;</span><span class="p">)</span>
<span class="n">chiSolverSetBasicOption</span><span class="p">(</span><span class="n">phys1</span><span class="p">,</span><span class="s2">&quot;residual_tolerance&quot;</span><span class="p">,</span><span class="mf">1.0e-6</span><span class="p">)</span>
</pre></div>
</div>
<p>We first create the diffusion solver with a call to
<code class="docutils literal notranslate"><span class="pre">chiDiffusionCreateSolver()</span></code>. This creates the solver and pushes it onto
the physics handler. The function returns the handle.</p>
<p>Next we can set numerous diffusion solver properties which can comprehensively
be viewed in its specific documentation (<code class="docutils literal notranslate"><span class="pre">chiDiffusionSetProperty()</span></code>).</p>
</section>
<section id="step-7-initialize-and-solve">
<h2>Step 7 - Initialize and Solve<a class="headerlink" href="#step-7-initialize-and-solve" title="Link to this heading"></a></h2>
<p>The final step of this process is to initialize and execute the diffusion solver.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chiDiffusionInitialize</span><span class="p">(</span><span class="n">phys1</span><span class="p">)</span>
<span class="n">chiDiffusionExecute</span><span class="p">(</span><span class="n">phys1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-8-post-processing">
<h2>Step 8 - Post-processing<a class="headerlink" href="#step-8-post-processing" title="Link to this heading"></a></h2>
<p>The execution of a OpenSn physics module culminates in the creation of one or
more field functions. These field functions should all be populated for use
during the initialization phase of the solver. Users can get handles to all
the field functions by using the <code class="docutils literal notranslate"><span class="pre">chiSolverGetFieldFunctionList</span></code> call. Thereafter, the
field function can be exported to VTK-format which can be read by Paraview.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fflist</span><span class="p">,</span><span class="n">count</span> <span class="o">=</span> <span class="n">chiSolverGetFieldFunctionList</span><span class="p">(</span><span class="n">phys1</span><span class="p">)</span>
<span class="n">chiExportFieldFunctionToVTK</span><span class="p">(</span><span class="n">fflist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;Tutorial1Output&quot;</span><span class="p">,</span><span class="s2">&quot;Temperature&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="complete-input-file">
<h2>Complete input file<a class="headerlink" href="#complete-input-file" title="Link to this heading"></a></h2>
<p>Here is the complete input file with comments</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="c1">############################################### Setup mesh</span>
<span class="n">chiMeshHandlerCreate</span><span class="p">()</span>

<span class="n">nodes</span><span class="o">=</span><span class="p">{}</span>
<span class="n">N</span><span class="o">=</span><span class="mi">32</span>
<span class="n">ds</span><span class="o">=</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span> <span class="n">do</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">ds</span>
<span class="n">end</span>
<span class="n">surf_mesh</span><span class="p">,</span><span class="n">region1</span> <span class="o">=</span> <span class="n">chiMeshCreateUnpartitioned3DOrthoMesh</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">nodes</span><span class="p">,</span><span class="n">nodes</span><span class="p">)</span>

<span class="n">chiVolumeMesherExecute</span><span class="p">();</span>

<span class="n">material</span> <span class="o">=</span> <span class="n">chiPhysicsAddMaterial</span><span class="p">(</span><span class="s2">&quot;Test Material&quot;</span><span class="p">);</span>

<span class="o">--</span> <span class="n">Set</span> <span class="n">Material</span> <span class="n">IDs</span>
<span class="n">vol0</span> <span class="o">=</span> <span class="n">chiLogicalVolumeCreate</span><span class="p">(</span><span class="n">RPP</span><span class="p">,</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">chiVolumeMesherSetProperty</span><span class="p">(</span><span class="n">MATID_FROMLOGICAL</span><span class="p">,</span><span class="n">vol0</span><span class="p">,</span><span class="n">material</span><span class="p">)</span>

<span class="n">chiMeshHandlerExportMeshToVTK</span><span class="p">(</span><span class="s2">&quot;Mesh&quot;</span><span class="p">)</span>
<span class="o">--</span><span class="c1">############################################### Add material properties</span>


<span class="o">--</span> <span class="n">Set</span> <span class="n">material</span> <span class="n">properties</span>
<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="n">SCALAR_VALUE</span><span class="p">,</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">SINGLE_VALUE</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="n">SCALAR_VALUE</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="n">SINGLE_VALUE</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>


<span class="o">--</span><span class="c1">############################################### Setup Physics</span>
<span class="n">phys1</span> <span class="o">=</span> <span class="n">chiDiffusionCreateSolver</span><span class="p">()</span>
<span class="n">chiSolverSetBasicOption</span><span class="p">(</span><span class="n">phys1</span><span class="p">,</span><span class="s2">&quot;discretization_method&quot;</span><span class="p">,</span><span class="s2">&quot;PWLC&quot;</span><span class="p">);</span>
<span class="n">chiSolverSetBasicOption</span><span class="p">(</span><span class="n">phys1</span><span class="p">,</span><span class="s2">&quot;residual_tolerance&quot;</span><span class="p">,</span><span class="mf">1.0e-6</span><span class="p">)</span>

<span class="o">--</span><span class="c1">############################################### Initialize and</span>
<span class="o">--</span>                                                <span class="n">Execute</span> <span class="n">Solver</span>
<span class="n">chiDiffusionInitialize</span><span class="p">(</span><span class="n">phys1</span><span class="p">)</span>
<span class="n">chiDiffusionExecute</span><span class="p">(</span><span class="n">phys1</span><span class="p">)</span>

<span class="o">----</span><span class="c1">############################################### Visualize the field function</span>
<span class="n">fflist</span><span class="p">,</span><span class="n">count</span> <span class="o">=</span> <span class="n">chiSolverGetFieldFunctionList</span><span class="p">(</span><span class="n">phys1</span><span class="p">)</span>
<span class="n">chiExportFieldFunctionToVTK</span><span class="p">(</span><span class="n">fflist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;Tutorial1Output&quot;</span><span class="p">,</span><span class="s2">&quot;Temperature&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-9-execute-the-code">
<h2>Step 9 - Execute the code<a class="headerlink" href="#step-9-execute-the-code" title="Link to this heading"></a></h2>
<p>Assuming you added the executable to your PATH environment variable, the code
can be executed by typing the executable name followed by the input file path
(relative or absolute).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opensn</span> <span class="n">Tutorial01</span><span class="o">.</span><span class="n">lua</span>
</pre></div>
</div>
<p>The output produced will look as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[0]  Parsing argument 1 Tutorials/Tutorial01.lua
[0]  2022-05-09 14:01:21 Running OpenSn in batch-mode with 1 processes.
[0]  OpenSn number of arguments supplied: 1
[0]  Computing cell-centroids.
[0]  Done computing cell-centroids.
[0]  Checking cell-center-to-face orientations
[0]  Done checking cell-center-to-face orientations
[0]  00:00:00 Establishing cell connectivity.
[0]  00:00:00 Vertex cell subscriptions complete.
[0]  00:00:00 Surpassing cell 3277 of 32768 (10%)
[0]  00:00:00 Surpassing cell 6554 of 32768 (20%)
[0]  00:00:00 Surpassing cell 9831 of 32768 (30%)
[0]  00:00:00 Surpassing cell 13108 of 32768 (40%)
[0]  00:00:00 Surpassing cell 16384 of 32768 (50%)
[0]  00:00:00 Surpassing cell 19661 of 32768 (60%)
[0]  00:00:00 Surpassing cell 22938 of 32768 (70%)
[0]  00:00:00 Surpassing cell 26215 of 32768 (80%)
[0]  00:00:00 Surpassing cell 29492 of 32768 (90%)
[0]  00:00:00 Surpassing cell 32768 of 32768 (100%)
[0]  00:00:00 Establishing cell boundary connectivity.
[0]  00:00:00 Done establishing cell connectivity.
[0]  00:00:00 VolumeMesherPredefinedUnpartitioned executing. Memory in use = 61 MB
[0]  Computed centroids
[0]  Partitioning mesh with ParMETIS.
[0]  Done partitioning mesh.
[0]  Cells loaded.
[0]  VolumeMesherPredefinedUnpartitioned: Cells created = 32768
[0]  00:00:00 VolumeMesherExecute: Volume meshing completed. Memory used = 43.5 MB
[0]  Total process memory used after meshing 104 MB
[0]  00:00:00 Setting material id from logical volume.
[0]  00:00:00 Done setting material id from logical volume. Number of cells modified = 32768.
[0]  Exporting mesh to VTK. 32768
[0]  Done exporting mesh to VTK.
[0]  Solver:DiffusionSolver option:discretization_method set to PWLC.
[0]  Solver:DiffusionSolver option:residual_tolerance set to 1e-06.
[0]
[0]  00:00:00 DiffusionSolver: Initializing Diffusion solver
[0]  Identifying unique boundary-ids.
[0]  Max boundary id identified: 0
[0]  00:00:00 Creating Piecewise Linear Continuous Finite Element spatial discretizaiton.
[0]  00:00:08 Developing nodal ordering.
[0]  00:00:08 Done creating Piecewise Linear Continuous Finite Element spatial discretizaiton.
[0]  DiffusionSolver: Global number of DOFs=35937
[0]  Building sparsity pattern.
[0]  00:00:09 DiffusionSolver: Diffusion Solver initialization time 8.76791
[0]  Setting matrix preallocation.
[0]  00:00:09 DiffusionSolver: Assembling A locally
[0]  00:00:09 DiffusionSolver: Done Assembling A locally
[0]  00:00:09 DiffusionSolver: Communicating matrix assembly
[0]  00:00:09 DiffusionSolver: Assembling A globally
[0]  00:00:09 DiffusionSolver: Diagonal check
[0]  Number of mallocs used = 0
[0]  Number of non-zeros allocated = 912673
[0]  Number of non-zeros used = 759717
[0]  Number of unneeded non-zeros = 152956
[0]  00:00:09 DiffusionSolver: Assembling x and b
[0]  00:00:09 DiffusionSolver: Solving system
[0]  Diffusion iteration    0 - Residual 2.6521952e+02
[0]  Iteration 0 Residual 265.22
[0]  Diffusion iteration    1 - Residual 3.1006314e+01
[0]  Iteration 1 Residual 31.0063
[0]  Diffusion iteration    2 - Residual 4.0467718e+00
[0]  Iteration 2 Residual 4.04677
[0]  Diffusion iteration    3 - Residual 4.9168004e-01
[0]  Iteration 3 Residual 0.49168
[0]  Diffusion iteration    4 - Residual 5.5399485e-02
[0]  Iteration 4 Residual 0.0553995
[0]  Diffusion iteration    5 - Residual 7.3128018e-03
[0]  Iteration 5 Residual 0.0073128
[0]  Diffusion iteration    6 - Residual 1.3610040e-03
[0]  Iteration 6 Residual 0.001361
[0]  Diffusion iteration    7 - Residual 1.7105415e-04
[0]  Iteration 7 Residual 0.000171054
[0]  Diffusion iteration    8 - Residual 2.2641339e-05
[0]  Iteration 8 Residual 2.26413e-05
[0]  Diffusion iteration    9 - Residual 3.3728166e-06
[0]  Iteration 9 Residual 3.37282e-06
[0]  Diffusion iteration   10 - Residual 3.1009104e-07
[0]  Iteration 10 Residual 3.10091e-07
[0]  Convergence reason: KSP_CONVERGED_RTOL
[0]  00:00:09 DiffusionSolver[g=0-0]: Number of iterations =10
[0]  Timing:
[0]  Assembling the matrix: 0.085187
[0]  Solving the system   : 0.075084
[0]  Diffusion Solver execution completed!
[0]  Exporting field function phi to files with base name Tutorial1Output
[0]  Final program time 00:00:10
[0]  2022-05-09 14:01:32 ChiTech finished execution of Tutorials/Tutorial01.lua
</pre></div>
</div>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="../_images/cube_solution_tut1.png"><img alt="../_images/cube_solution_tut1.png" src="../_images/cube_solution_tut1.png" style="width: 700px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2 - Solution viewed in Paraview</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Basic Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="output.html" class="btn btn-neutral float-right" title="Tutorial 2: Other Forms of Output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-present, OpenSn team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>